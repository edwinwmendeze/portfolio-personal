---
import type { Project } from '@types';
import Tag from '../ui/Tag.astro';

interface Props {
  project: Project;
  featured?: boolean;
  showTitle?: boolean;
}

const { project, featured = false, showTitle = true } = Astro.props;

// Determinar el estado del proyecto (Destacado, Nuevo, etc.)
const status = featured ? "Destacado" : "Proyecto";

// Procesar la URL del proyecto para los diferentes enlaces
const githubUrl = project.url && project.url.includes('github.com') ? project.url : null;
const webUrl = project.url && !project.url.includes('github.com') ? project.url : null;

// Generar URL para la imagen basada en el nombre del proyecto
const projectImageSvg = `/portfolio-personal/images/projects/${project.name.toLowerCase().replace(/\s+/g, '-')}.svg`;
const defaultImage = `/portfolio-personal/images/project-placeholder.svg`;

// FunciÃ³n para obtener el Ã­cono adecuado segÃºn la tecnologÃ­a
function getTechIcon(tech: string): string {
  const techIcons: Record<string, string> = {
    'Python': 'ğŸ',
    'Vue.js': 'ğŸŸ¢',
    'Vue': 'ğŸŸ¢',
    'Nuxt': 'ğŸŸ¢',
    'Nuxt.js': 'ğŸŸ¢',
    'React': 'âš›ï¸',
    'TypeScript': 'ğŸ”·',
    'JavaScript': 'ğŸŸ¨',
    'Node.js': 'ğŸŸ©',
    'Node': 'ğŸŸ©',
    'Electron': 'ğŸ”·',
    'MongoDB': 'ğŸƒ',
    'Firebase': 'ğŸ”¥',
    'Supabase': 'âš¡',
    'Docker': 'ğŸ³',
    'AWS': 'â˜ï¸',
    'GCP': 'â˜ï¸',
    'Google Cloud': 'â˜ï¸',
    'Azure': 'â˜ï¸',
    'Vercel': 'â–²',
    'GitHub': 'ğŸ™',
    'Git': 'ğŸ”„',
    'HTML': 'ğŸŒ',
    'CSS': 'ğŸ¨',
    'SASS': 'ğŸ’…',
    'Tailwind': 'ğŸŒŠ',
    'Tailwind CSS': 'ğŸŒŠ',
    'Bootstrap': 'ğŸ…±ï¸',
    'Django': 'ğŸ¦„',
    'Flask': 'ğŸ§ª',
    'Express': 'ğŸš‚',
    'GraphQL': 'ğŸ”·',
    'REST': 'ğŸ“¡',
    'SQL': 'ğŸ—ƒï¸',
    'PostgreSQL': 'ğŸ˜',
    'MySQL': 'ğŸ¬',
    'Redis': 'ğŸ”´',
    'Svelte': 'ğŸ”¥',
    'Angular': 'ğŸ…°ï¸',
    'AI': 'ğŸ¤–',
    'Machine Learning': 'ğŸ§ ',
    'TensorFlow': 'ğŸ“Š',
    'PyTorch': 'ğŸ”¥',
    'Next.js': 'â–²',
    'Next': 'â–²',
    'Gatsby': 'ğŸ’œ',
    'PHP': 'ğŸ˜',
    'Laravel': 'ğŸ”´',
    'Ruby': 'ğŸ’',
    'Rails': 'ğŸš„',
    'Java': 'â˜•',
    'Spring': 'ğŸƒ',
    'C#': 'ğŸŸª',
    '.NET': 'ğŸŸ¦',
    'Swift': 'ğŸ',
    'Kotlin': 'ğŸŸ ',
    'Flutter': 'ğŸ¦‹',
    'Dart': 'ğŸ¯',
    'Go': 'ğŸ¦¦',
    'Rust': 'ğŸ¦€',
    'WebAssembly': 'ğŸ§©',
    'WebGL': 'ğŸ®',
    'Three.js': 'ğŸ²',
    'D3.js': 'ğŸ“Š',
    'Astro': 'ğŸš€',
    'Vite': 'âš¡',
    'Webpack': 'ğŸ“¦',
    'Rollup': 'ğŸ”„',
    'Cypress': 'ğŸ§ª',
    'Jest': 'ğŸƒ',
    'Vitest': 'ğŸ§ª',
    'Storybook': 'ğŸ“š',
    'Figma': 'ğŸ¨',
    'Sketch': 'ğŸ’',
    'Adobe XD': 'ğŸ¨',
    'Photoshop': 'ğŸ–Œï¸',
    'Illustrator': 'âœï¸',
    'pyautogui': 'ğŸ¤–',
  };

  return techIcons[tech] || 'ğŸ”§'; // Emoji predeterminado si no se encuentra la tecnologÃ­a
}
---

<div class="project-card" data-featured={featured}>
  <div class="project-card-overlay"></div>
  
  {featured && (
    <div class="feature-badge">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
      </svg>
    </div>
  )}
  
  <div class="project-image-container">
    <img 
      src={projectImageSvg} 
      alt={`Captura de pantalla de ${project.name}`} 
      class="project-image"
      loading="lazy"
      onerror={`this.onerror=null; this.src='${defaultImage}'`}
    />
    <div class="status-tag-container">
      <span class="project-tag">{status}</span>
    </div>
  </div>

  <div class="project-content">
    {showTitle && (
      <h2 class="project-title">{project.name}</h2>
    )}
    <p class="project-description">{project.description}</p>
    
    {project.highlights && project.highlights.length > 0 && (
      <div class="project-highlights">
        <button class="highlights-toggle" aria-expanded="false" aria-controls={`highlights-${project.name.replace(/\s+/g, '-')}`}>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="toggle-icon">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span>CaracterÃ­sticas destacadas</span>
        </button>
        
        <ul id={`highlights-${project.name.replace(/\s+/g, '-')}`} class="highlights-list">
          {project.highlights.map((highlight) => (
            <li>{highlight}</li>
          ))}
        </ul>
      </div>
    )}
    
    <div class="tech-tags">
      {project.technologies && project.technologies.map((tech: string, index: number) => (
        index < 4 ? 
          <span class="tech-tag" title={tech}>
            <span class="tech-icon">{getTechIcon(tech)}</span>
            <span class="tech-name">{tech}</span>
          </span> : null
      ))}
      {project.technologies && project.technologies.length > 4 && (
        <span class="tech-tag more-tag">+{project.technologies.length - 4}</span>
      )}
    </div>
    
    <div class="project-links">
      {githubUrl && (
        <a href={githubUrl} class="project-link github-link" target="_blank" rel="noopener noreferrer">
          <span class="github-icon"></span>
          <span>GitHub</span>
        </a>
      )}
      
      {webUrl && (
        <a href={webUrl} class="project-link web-link" target="_blank" rel="noopener noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="2" y1="12" x2="22" y2="12"></line>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
          </svg>
          <span>Sitio Web</span>
        </a>
      )}
    </div>
  </div>
</div>

<style>
  .project-card {
    display: flex;
    flex-direction: column;
    border-radius: 0.75rem;
    overflow: hidden;
    background-color: var(--color-card, #ffffff);
    border: 1px solid var(--color-border, #e5e7eb);
    box-shadow: 
      0 4px 6px -1px rgba(0, 0, 0, 0.1), 
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: 
      transform 0.3s ease, 
      box-shadow 0.3s ease, 
      background-color 0.3s ease;
    position: relative;
    height: 100%;
  }

  .project-card:hover {
    transform: translateY(-8px);
    box-shadow: 
      0 12px 20px -4px rgba(0, 0, 0, 0.15), 
      0 8px 10px -6px rgba(0, 0, 0, 0.1);
  }

  .project-card:hover .project-card-overlay {
    opacity: 1;
  }

  .project-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(59, 130, 246, 0.05);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 1;
  }

  .feature-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background-color: var(--color-primary, #3b82f6);
    color: white;
    border-radius: 9999px;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .project-image-container {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    background-color: var(--color-background-alt, #f3f4f6);
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .project-card:hover .project-image {
    transform: scale(1.05);
  }

  .status-tag-container {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    z-index: 2;
  }

  .project-tag {
    display: inline-block;
    background-color: var(--color-primary, #3b82f6);
    color: #ffffff;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }

  .project-content {
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    flex-grow: 1;
  }

  .project-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--color-text, #1f2937);
  }

  .project-description {
    font-size: 0.875rem;
    line-height: 1.5;
    color: var(--color-text-light, #6b7280);
    margin-bottom: 1rem;
    flex-grow: 1;
  }

  .project-highlights {
    margin-bottom: 1rem;
  }

  .highlights-toggle {
    background: none;
    border: none;
    display: flex;
    align-items: center;
    color: var(--color-primary, #3b82f6);
    cursor: pointer;
    padding: 0.25rem 0;
    font-family: inherit;
    font-size: 0.875rem;
    font-weight: 500;
    width: 100%;
    text-align: left;
  }

  .toggle-icon {
    margin-right: 0.5rem;
    transition: transform 0.3s ease;
  }

  .highlights-toggle[aria-expanded="true"] .toggle-icon {
    transform: rotate(180deg);
  }

  .highlights-list {
    margin: 0.75rem 0;
    padding-left: 1.5rem;
    font-size: 0.875rem;
    color: var(--color-text, #1f2937);
    display: none;
  }

  .highlights-list.active {
    display: block;
    animation: fadeIn 0.3s ease forwards;
  }

  .highlights-list li {
    margin-bottom: 0.5rem;
    position: relative;
  }

  .highlights-list li:before {
    content: "â€¢";
    color: var(--color-primary, #3b82f6);
    font-weight: bold;
    display: inline-block;
    width: 1em;
    margin-left: -1em;
  }

  .tech-tags {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 1.25rem;
    gap: 0.5rem;
  }

  .tech-tag {
    display: flex;
    align-items: center;
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    background-color: var(--color-background-alt, #f3f4f6);
    color: var(--color-text, #1f2937);
    border: 1px solid var(--color-border, #e5e7eb);
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
  }

  .tech-icon {
    margin-right: 0.375rem;
    font-size: 0.875rem;
  }

  .tech-tag:hover {
    background-color: var(--color-primary, #3b82f6);
    color: #ffffff;
    border-color: var(--color-primary, #3b82f6);
  }

  .more-tag {
    background-color: var(--color-primary-transparent, rgba(59, 130, 246, 0.1));
    color: var(--color-primary, #3b82f6);
  }

  .more-tag:hover {
    background-color: var(--color-primary, #3b82f6);
    color: white;
  }

  .project-links {
    display: flex;
    gap: 1rem;
    margin-top: auto;
    font-size: 0.875rem;
  }

  .project-link {
    display: flex;
    align-items: center;
    color: var(--color-primary, #3b82f6);
    font-weight: 500;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .project-link:hover {
    color: var(--color-primary-dark, #2563eb);
  }

  .project-link svg,
  .github-icon {
    margin-right: 0.375rem;
    transition: transform 0.2s ease;
  }

  .project-link:hover svg,
  .project-link:hover .github-icon {
    transform: scale(1.1);
  }

  /* GitHub icon SVG styling */
  .github-icon {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.483 0-.237-.009-.869-.014-1.704-2.782.604-3.369-1.342-3.369-1.342-.454-1.157-1.11-1.465-1.11-1.465-.908-.62.069-.608.069-.608 1.003.074 1.532 1.029 1.532 1.029.891 1.529 2.341 1.089 2.91.833.091-.647.349-1.086.635-1.337-2.22-.253-4.555-1.112-4.555-4.943 0-1.091.39-1.984 1.029-2.682-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.547 9.547 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.202 2.394.1 2.647.64.698 1.028 1.591 1.028 2.682 0 3.841-2.337 4.687-4.565 4.935.359.307.678.917.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .269.18.579.688.482A10.001 10.001 0 0022 12c0-5.523-4.477-10-10-10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .project-title {
      font-size: 1.125rem;
    }
    
    .project-description {
      font-size: 0.8125rem;
    }
  }
  
  @media print {
    .project-card {
      break-inside: avoid;
      box-shadow: none;
      border: 1px solid #ddd;
    }
    
    .project-title {
      font-size: 14pt;
    }
    
    .project-description {
      font-size: 10pt;
    }
    
    .feature-badge,
    .project-image-container,
    .tech-tags,
    .project-links,
    .project-highlights {
      display: none;
    }
  }
</style>

<script>
  // Activar la funcionalidad de mostrar/ocultar caracterÃ­sticas destacadas
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButtons = document.querySelectorAll('.highlights-toggle');
    
    toggleButtons.forEach(button => {
      button.addEventListener('click', () => {
        const expanded = button.getAttribute('aria-expanded') === 'true';
        button.setAttribute('aria-expanded', (!expanded).toString());
        
        const targetId = button.getAttribute('aria-controls');
        if (targetId) {
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.classList.toggle('active');
            
            // Cambiar el texto del botÃ³n
            const buttonText = button.querySelector('span');
            if (buttonText) {
              buttonText.textContent = expanded ? 
                'CaracterÃ­sticas destacadas' : 
                'Ocultar caracterÃ­sticas';
            }
          }
        }
      });
    });
  });
</script>